计算机组成原理

- 概述篇

#### 计算机的体系与结构

#### 冯诺依曼体系

- 存储器
- 控制器
- 运算器
- 输入设备
- 输出设备

- 能够把需要的程序和数据送到计算机中
- 能够长期记忆程序、数据、中间结构及最终运算结果的能力
- 能够具备算数、逻辑运算和数据传送等数据加工处理的能力
- 能够按照要求将处理结果输出给用户

### 计算机的层次与编程语言

#### 程序翻译与程序解释

- 计算机 执行的指令都是L0
- 翻译过程中生成新的L0程序，解释过程不生成新的L0程序
- 解释过程由L0辨析的解释器去解释L1程序

#### 计算机的层次与编程语言

- 应用层
  - 满足某些应用的程序
- 高级语言层
  - 编程语言为广大程序员所接受的高级语言
  - 高级语言的种类非常多：几百种
  - 常见的高级语言由：Python、java、Golang、c、C++等
- 汇编语言层
  - 编程语言是汇编语言
  - 汇编语言可以翻译成可直接执行的机器语言
  - 完成编译的过程的程序就是汇编器
- 操作系统层
  - 向上提供了简易的操作界面
  - 向下对接指令系统，管理硬件资源
  - 操作系统是软件和硬件之间的适配层
- 传统机器层
  - 编程语言是CPU指令集（机器指令）
  - 编程语言和硬件直接相关
  - 不同的cpu使用不同的CPU指令集
- 微程序机器层
  - 编程语言是微指令集
  - 微指令所组成的微程序直接交由硬件执行
- 硬件逻辑层
  - 门、触发器等逻辑电路组成
  - 属于电子工程领域

### 计算机的计算单位

#### 容量单位

- 在物理层面，高低电平记录信息
- 理论上只认识0/1两种状态
- 0/1能表示的内容太少，需要更大的容量表示方法

|          | bit    | Byte  | kB     | MB       | GB         | TB     | PB     | EB       |
| -------- | ------ | ----- | ------ | -------- | ---------- | ------ | ------ | -------- |
| 名字     | 比特位 | 字节  | 千字节 | 兆字节   | 吉字节     | 太字节 | 拍字节 | 艾字节   |
| 比例     | -      | 8bits | 1024B  | 1024KB   | 1024MB     | 1024GB | 1024TB | 1024PB   |
| 常见设备 | 门电路 | -     | 寄存器 | 高速缓存 | 内存、硬盘 | 硬盘   | 云硬盘 | 数据仓库 |

#### 速度单位

- 网络速度

```shell
100M/s = 100M ？
网络常用单位为Mbps
100M/s = 100Mbps = 100Mbit/s
100Mbit/s = (100/8)MB/s = 12.5MB/s
```

- CPU频率

```shell
cpu的速度一般体现为CPU的时钟频率
CPU的时钟频率的单位一般是赫兹（Hz）
主流CPU的时钟频率都在2GHz 以上
并不是描述计算机领域的专有单位

2GHz = 2*1000^3Hz = 每秒20亿次 高低电频的次数


Hz其实就是秒分之一 # 它是每秒钟的周期性变动重复次数的计量

```



#### 计算机的字符与编码集

```shell
使用7个bits就可以表示ASCLL码
包含95个可打印字符
33个不可打印字符（包括控制字符）
```

#### 字符编码集的国际化

```shell
中文编码集
GB2312  国标
	一共收录了7445个字符
	包含6763个汉字和682个其他符号
GBK 《汉字内码扩展规范》
	向下兼容GB2312，向上支持国际ISO标准
	收录了21003个汉字，支持全部中日韩汉字
Unicode 统一码、万国码、单一码
	Unicode定义了世界通用的符号集，UTF-*实现编码
	UTF-8以字节为单位对Unicode进行编码

```

- 组成篇

#### 计算机的总线

```shell
总线的概述
	提供对外连接的接口
	不同设备可以通过USB接口进行连接
	连接的标准，促使外围设备接口的统一
总线的分类
	片内总线
		芯片内部的总线
		寄存器与寄存器之间
		寄存器与控制器、运算器之间
		高集成度芯片内部的信息传输线
	系统总线
		CPU、主内存、IO设备、各组件之间的信息传输线
		数据总线
			双向传输各个部件的数据信息
			数据总线的位数（总线宽度）是数据总线的重要参数
		地址总线
			地址总线位数=n，寻址范围0-2**n
			指定源数据或目的数据在内存中的地址
			地址总线的位数与存储单元有关
		控制总线
			控制总线是用来发出各种控制信号的传输线
			控制信号经由控制总线从一个组件发给另外一个组件
			控制总线可以监视不同组件之间的状态（就绪、未就绪）
```

#### 总线的仲裁

```shell
总线的仲裁
	为了解决总线使用权的冲突问题
总线仲裁的方法
	- 链式查询
		好处：电路复杂度低、仲裁方式简单
		坏处：优先级低的设备难以获得总线使用权
		坏处：对电路故障敏感
	- 计时器定时查询
		仲裁控制器对设备编号并使用计时器累计计数
		接收到仲裁信号后，往所有设备发出计数值
		计数值与设备编号一致则获得总线使用权
	- 独立请求
		每个设备均有总线连接仲裁器
		设备可单独向仲裁器发送请求和接收请求
		当同时收到多个请求信号，仲裁器有权按优先级分配使用权
		好处：相应速度快，优先顺序可动态变化
		坏处：设备连线多，总线控制复杂
```

计算机的输入输出设备

```shell
输入输出接口的通用设计
	数据线
		是I/O设备与主机之间进行数据交换的传送线
		单向传输的数据线
		双向传输的数据线
	状态线
		IO设备状态向主机架报告的信号线
		查询设备是否已经正常连接就绪
		查询设备是否已经被占用
	命令线
		CPU向设备发送命令的信号线
		发送读写信号
		发送启动停止信号
	设备选择线
		主机选择I/O设备进行操作的信号线
		对连接在总线上的设备进行选择
```

CPU与IO设备的通信

```shell
程序中断
	当外围IO设备就绪时，向CPU发出中断信号
	CPU有专门的电路响应中断信号
	提供低速设备通知CPU的一种异步的方式
	CPU可以高速运转同时兼顾低速设备的响应
DMA(直接存储器访问)
	DMA直接连接主存与IO设备
	DMA工作时不需要CPU的参与
	当主存以IO设备交换信息时，不需要中断CPU
```

#### 存储器的层次结构

- 缓存
- 主存
- 辅存
- 原理：局部性原理
- 实现：在CPU与主存之间增加一层速度快(容量小)的Cache
- 目的：解决主存与CPU速度不匹配的问题

局部性原理

```shell
局部性原理：是指CPU访问存储器时，无论是存取指令还是存取数据，所访问的存储单元都趋于聚集在一个较小的连续区域中
```

主存-辅存层次结构

- 原理：局部性原理
- 实现：主存之外增加辅助存储器（SD卡，U盘等）
- 目的：解决主容量不足

#### 计算机的主存储器与辅助存储器

- 主存储器
  - RAM（随机存取存储器）
  - RAM通过电容存储数据，必须隔一段时间刷新一次
  - 如果断电，那么一段时间后将丢失所有数据
- 辅助存储器-磁盘
  - 先来先服务算法
    - 按照顺序访问进程的磁道读写需求
  - 最短寻道时间优先
  - 扫描算法（电梯算法）
    - 每次只往一个方向移动
    - 到达一个方向需要服务的尽头再反向移动
  - 循环扫描算法

#### 计算机的高速缓存

#### 高速缓存的工作原理

- 字：是指放在一个存储单元中的二进制代码组合
  - 字的地址包含两个部分
  - 前m位指定字块的地址
  - 后b位指定字在字块中的地址
- 字块：存储在连续的存储单元中而被看做是一个单元的一组字
- 命中率是衡量缓存的重要性能指标
- 理论上CPU每次都能从高速缓存中取数据的时候，命中率为1

#### 高速缓存的替换策略

- 随机算法
- 先进先出算法（FIFO）
  - 把高速缓存看做是一个先进先出的队列
  - 优先替换最先进入队列的字块
- 最不经常使用算法（LFU）
  - 优先淘汰最不经常使用的字块
  - 需要额外的空间记录字块的使用频率

- 最近最少使用算法（LRU）

  - 优先淘汰一段时间内没有使用的字块
  - 有多种实现方法，一般使用双向链表
  - 把当前访问节点置于链表前面（保证链表头部节点是最近使用的）

#### 计算机指令系统

##### 机器指令的形式

```shell
机器指令主要由两部分组成：操作码、地址码
	操作码
		操作码指明指令所要完成的操作
		操作码的位数反应了机器操作的种类
     地址码
     	地址码直接给出操作数或者操作数的地址
     	分为三地址码、二地址码、一地址码
     零地址码
     	在机器指令中无地址码
     	空操作、停机操作、中断操作等
```

##### 机器指令的操作类型

```shell
数据操作
    寄存器之间、寄存器与存储单元、存储单元之间传送
    数据读写、交换地址数据、清零置一等操作
算数逻辑操作
	操作数之间的加减乘除运算
	操作数的与或非等逻辑位运算
移位操作
	数据左移（乘2）、数据右移（除2）
	完成数据在算数逻辑单元的必要操作
控制指令
	等待指令、停机指令、空操作指令、中断指令等
```

##### 机器指令的寻址方式

```shell
指令寻址：
	顺序寻址
	跳跃寻址
数据寻址：
	立即寻址
		指令直接获得操作数
		无需访问存储器
	直接寻址
		直接给出操作数在主存的地址
		寻找操作数简单，无需计算数据地址
	间接寻址
		指令地址码给出的是操作数地址的地址
```

| 寻址方式 | 优点             | 缺点                         |
| -------- | ---------------- | ---------------------------- |
| 立即寻址 | 速度快           | 地址码位数限制操作数表示范围 |
| 直接寻址 | 寻找操作数简单   | 地址码位数限制操作数寻址范围 |
| 间接寻址 | 操作数寻址范围大 | 速度较慢                     |

#### 计算机的控制器

> 控制器是协调和控制计算机运行的

##### 控制器的组成

- 程序计数器
  - 程序计数器用来存储下一条指令的地址
  - 循环从程序计数器中拿出指令
  - 当指令被拿出时，指向下一条指令
- 时序发生器
  - 电气工程领域，用于发送时序脉冲
  - CPU依据不同的时序脉冲有节奏的进行工作
- 指令译码器
  - 指令译码器是控制器主要部件之一
  - 计算机指令由操作码和地址码组成
  - 翻译操作码对应的操作以及控制传输地址码对应的数据
- 各种寄存器
  - 指令寄存器
    - 指令寄存器也是控制器的主要部件之一
    - 从主存或高速缓存取计算机指令
  - 主存地址寄存器
    - 保存当前CPU正要访问的内存单元的地址
  - 主存数据寄存器
    - 保存当前CPU正要读或写的主存数据
  - 通用寄存器
    - 用于暂时存放或传送数据或指令
    - 可保存ALU的运算中间结果
    - 容量比一般专用寄存器要大
- 总线

#### 计算机的运算器

> 运算器是用来进行数据运算加工的

- 数据缓冲器
  - 分为输入缓冲和输出缓冲
  - 输入缓冲暂时存放外设送来的数据
  - 输出缓冲暂时存放往外设的数据
- ALU
  - ALU：算数逻辑单元、是运算器的主要组成
  - 常见的位运算（左右移、与或非等）
  - 算数运算（加减乘除等）
- 通用寄存器
  - 用于暂时存放或传送数据或指令
  - 可保存ALU的运算中间结果
  - 容量比一般专用寄存器要大
- 状态字寄存器
  - 存放运算状态（条件码、进位、溢出、结果正负等）
  - 存放运算控制信息（调试跟踪标记位、允许中断位等）
- 总线

#### 计算机指令的执行过程

指令执行过程

```shell
取指令 -------------》 分析指令 -------------》 执行指令
从缓存取指令		指令译码器译码				装载数据到寄存器
送到指令寄存器		发出控制信号				ALU处理数据
				程序计数器+1			 	 记录运算状态
										送出运算结果
```

CPU的流水线设计

- 类似工厂的装配线
- 工厂的装配线使得多个产品同时被加工
- 在同一时刻，不同产品均位于不同的加工阶段

#### 进制运算的基础

- 进制的概述

  - 进制的定义
    - 进位制是一种计数方式，亦称进制位或位值计数法
    - 有限数字符号来标识无限的数值
    - 使用的数字符号的数目称为这种进位制的基数或底数
  - 常见的进制
    - 二十进制
      - 玛雅文明的玛雅数字
      - 因努伊特的因努伊特数字
    - 六十进制
      - 时间、坐标、角度等量化数据
    - 十六进制
      - 0-9 和ABCDEF 组成
      - mac地址就是十六进制
    - 八进制
      - 计算机喜欢二进制，但是二进制太长了
      - 使用大进制位可以解决这个问题八进制、十六进制满足2的n次方要求

- 二进制运算的基础

  - 二进制转换为十进制:按权展开法

  - 十进制转换为二进制：重复相除法

    - | 重复除2 | 得商 | 取余数 |
      | ------- | ---- | ------ |
      | 6/2     | 3    | 0      |
      | 3/2     | 1    | 1      |
      | 1/2     | 0    | 1      |

    - ```shell
      6的二次方是 110 
      ```

#### 有符号数和无符号数

##### 原码表示法

- 使用0表示正数，1表示负数
- 规定符号位位于数值第一位
- 表达简洁明了，是人类最容易理解的表示法

##### 二进制的补码表示法

```shell
x=13 计算x的原码和补码
原码：x = 0,1101
补码：0,1101

x = -13 计算x的原码和补码
原码：x = 1,1101
补码：x = 10011    

补码的计算方法： 
	正数的补码 = 原码
	负数的补码 = {原码符号位不变} + {数值位按位取反后+1}  

```

##### 二进制的反码

```shell
反码的目的是找出原码和补码之间的规律，消除转换过程中的减法
x = -13 计算x的原码和反码
原码是：x = 1，1101
反码是：x = 1, 0010
```

#### 双向链表的原理和实践

```shell


```

## 操作系统

#### 多道程序设计

- 早期批处理系统只能一次处理一个任务
- 多道程序设计使得批处理系统可以一次处理多个任务
- 多道程序设计师指在计算机内存中同时存放多个程序
- 多道程序设计在计算机的管理程序之下相互穿插运行
