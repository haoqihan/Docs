为什么socket的比较难用

- 数据粘包问题
- 数据丢包
- 心跳维持
- 性能问题

什么是网络编程

- 什么是网络、计算机网络的构成？

什么是网络？

- 在计算机领域中，网络是信息传输，接收，共享的虚拟平台
- 通过把各个点、面、体的信息联系到一起，从而实现这些资源的共享

什么是网络编程

- 网络编程从大的方面来说是对数据发送到接收
- 通过操作相应API调度计算机硬件资源，并利用传输通道(网线)进行数据交换的过程
- 更为具体的涉及：网络模型、套接字、数据包

7层网络模型

- 基础层：基础层(physical)、数据链路层(Datalink)、网络层(network)
- 传输层(Transport)：TCP-UDP 协议层，socket
- 高级层：会话层(session)、表示层(presentation)、应用层(Application)

### socket与UDP、TCP

什么是socket

- 简单来书是IP地址与端口的结合协议(RFC 793)
- 一种地址与端口结合的描述协议
- TCP/IP 协议的相关API的总称；是网络API的集合实现

socket的作用和组成

- 在网络传输中用于唯一标示两个端点之间的连接
- 端点：(IP + Port)
- 四个要素：客户端地址、客户端端口、服务器地址、服务器端口

什么是TCP

- TCP是面向连接的通信协议
- 通过三次握手建立连接、通讯完成时要拆除连接
- 由于Tcp是面向连接，所以只能用于端到端的通讯

什么是UDP

- UDP是面向无连接的通讯协议
- UDP数据包括目的端口号和源端口号信息
- 由于通讯不需要连接、所以可以实现广播发送、并不局限于端到端

client-server Application

- TCP/IP 协议中，两个进程通讯的主要模式：Cs模型
- 主要目的：协同网络中的计算机资源、服务模式、进程间数据共享
- 常见：FTP、SMTP、HTTP

### 报文、协议、mac地址

#### 报文段

- 报文段是指TCP/IP协议网络传输过程中，起着路由导航作用
- 用以查询各个网络路由段、IP地址、交换协议等IP数据包
- 报文段充当整个TCP/IP 协议数据包的导航路由功能
- 报文在传输过程中会不断地封装成分组、包、帧来传输
- 封装方式就是添加一些控制信息组成的首部，即报文头

#### 传输协议

- 协议，顾名思义，一种规定、约束
- 约定大于配置，在网络传输中依然适用，网络的传输流程是健壮的、稳定的，得益于基础的协议构成
- 简单来说：A `-> `B 传输数据；B能识别；反之B `-> `A的传输数据；A也能识别；这就是协议

#### MAC地址

- 意为媒体访问控制，或称为物理地址、硬件地址
- 用来定义网络设备的位置

### IP、端口、远程服务器

#### IP地址

- 互联网协议地址
- 是分配给网络上使用网际协议的设备的数字标签
- 常见的ip地址分为ipv4和ipv6两种
- IP地址由32位二进制数组成，常以xxx.xxx.xxx.xxx 形式表现，每组xxx代表小于或等于255的10进制数
- 分为A、B、C、D、E五大类，其中E类属于特殊保留地址

#### ip地址IPv4

- 总量：4，294，967,296个(即232)：42亿个；最终于2011年2月3号用尽
- 如果主机号全为1，那么这个地址为直接广播地址
- ip地址：`255.255.255.255`为受限广播地址

IPv6

- 总共有128位长，ipv6地址的表达形式，一般采用32个十六进制数，也可以想象为1632个
- 由两个逻辑部分组成：一个64位的网络前缀和一个64位的主机地址，主机地址通常根据物理地址自动生成，叫做EUI-64(或者64-位扩展唯一标识)
- ipv4转换为ipv6一定可行，ipv6转换为ipv4不一定可行

#### 端口

- 如果把ip地址比作一间房子，端口就是出入这间房子的门或窗户
- 在不同门窗后有不同的人，房子中的用户与外界交流的出口
- 外界鸽子(信息)飞到不同的窗口也就是给不同的人传递信息
- 0-1023号端口以及1024-49151号端口都是特殊端口
- 计算机之间依照互联网传输层TCP/IP协议的协议信息，不同的协议都对应不同的端口
- 49152到65535 号端口属于`动态端口`范围，没有端口可以被证实地注册占用

#### 远程服务器

- 局域网；一般而言，家里的环境以及公司相互电脑之间环境都属于局域网

### UDP

- 一种用户数据报协议，又称为用户数据报文数据
- 是一个简单的面向`数据报`的传输层协议，正式规范为RFC 768
- 用户数据协议，非连接协议

#### 为什么不可靠

- 它一旦把应用程序发送给网络层的数据发送出去就不保留数据备份
- UDP在IP数据报的头部仅仅加入了复用和数据校验（字段）
- 发送端产生数据，接收端从网络抓取数据
- 结构简单、无校验、速度快、容易丢包、广播

#### 能做些什么

- DNS、TFTP、SNMP
- 视音频、普通数据(无关紧要的数据)

#### UDP包最大长度

- `16位` -> 2字节  存储长度信息
- 2^16 -1 = 64k - 1 = 65536-1 = 65535 字节
- 自身协议占用 64位  8字节
-   65507 约等于 64K 
-  udp包头占8字节, ip包头占20字节, 65535-28 = 65507 

#### UDP的核心API

##### DategramSocket

- 用于接收与发送UDP的类
- 负责发送某一个UDP包或者接收UDP包
- 不同于TCP，UDP没有合并到socket API中
- `DategramSocket()` 创建简单实例，不指定端口与IP
- `DategramSocket(int port)`创建监听固定短开口的实例
- `DategramSocket(int port,inetAddress localaddr)`创建固定端口和指定ip的实例
- `receive(DategramSocket d)`:接收
- `send(DategramSocket d)`:发送
- `setSoTimeout(int timeout)`:设置超时，毫秒
- `close()`:关闭，释放资源

#### DatagramPacket

- 用于处理报文
- 将byte数组、目标地址、目标端口等数据包包装成报文或者将报文拆卸成byte数组
- 是UDP的发送实体和接收实体
- `DatagramPacket(byte[] buf,int offset,int length,inetAddress address,int port )`
- 前三个参数指定buf的使用区间
- 后两个参数指定目标机器地址与端口

```java
setData(byte[] buf,int offset,int length)
setData(byte[] buf)
setLength(int length)
getData()、getOffset()、getLength()

setAddress(inetAddress iaddr)
setPort(int iport)

getAddress()、getPort()

setSocketAddress(SocketAddress address)
getSocketAddress()
```

UDP单播、广播、多播

- 单播：点对点
- 多播（组播）：给多个点发送信息
- 广播：给所有的点发送信息

广播地址

- 255.255.255.255 为受限广播地址
- C网广播地址一般为：`XXX.XXX.XXX.255`(192.168.1.255)





























































